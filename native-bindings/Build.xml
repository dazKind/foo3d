<xml>
    <include name="${HXCPP}/build-tool/BuildCommon.xml"/>

    <!-- Determine the output location for the NDLL -->
    <set name="LIB_DIR" value="-L" unless="windows"/>
    <set name="LIB_DIR" value="-libpath:" if="windows"/>
    <section if="linux">
        <set name="LIB_PLATFORM" value="Linux"/>
        <set name="LIB_CPU_TYPE" value="" unless="HXCPP_M64"/>
        <set name="LIB_CPU_TYPE" value="64" if="HXCPP_M64"/>
    </section>
    <section if="windows">
        <set name="LIB_PLATFORM" value="Windows"/>
        <set name="LIB_CPU_TYPE" value="" unless="HXCPP_M64"/>
        <set name="LIB_CPU_TYPE" value="64" if="HXCPP_M64"/>
    </section>

    <set name="LIB_SUFFIX" value="${LIB_PLATFORM}${LIB_CPU_TYPE}"/>

    <!-- Specify the list of files to be compiled and the compile options. -->
    <set name="FOO3D_DIR" value="../../"/>
    <files id="foo3d">
        <compilerflag value="-I${FOO3D_DIR}/native-bindings/src"/>
        <compilerflag value="-Iinclude"/>
        <compilerflag value="-I/usr/include" if="linux"/>
        <compilerflag value="-DWIN32" if="windows"/>
        <compilerflag value="-DHXCPP_FLOAT32"/><!-- important for data transfers! -->
        <compilerflag value="-DGLEW_STATIC"/>
        <compilerflag value="-std=c++0x" if="linux"/>
        <file name="src/Foo3D.cpp"/>
    </files>

    <files id="frame">
        <compilerflag value="-I${FOO3D_DIR}/native-bindings/src"/>
        <compilerflag value="-Iinclude"/>
        <compilerflag value="-DWIN32" if="windows"/>
        <compilerflag value="-DHXCPP_FLOAT32"/><!-- important for data transfers! -->
        <compilerflag value="-std=c++0x" if="linux"/>
        <file name="src/Frame.cpp"/>
    </files>

    <!-- Generate the NDLL. -->
    <set name="configuration_type" value="dll" unless="iphone"/>
    <set name="configuration_type" value="static_link" if="iphone"/>

    <target id="foo3d-hx" output="foo3d" tool="linker" toolid="${configuration_type}">

        <haxedef name="HXCPP_STACK_TRACE" if="debug" />
        <haxedef name="HXCPP_STACK_LINE" if="debug" />
        <haxedef name="HXCPP_DEBUG_LINK" if="debug" />

        <!-- Use this switch to add/remove glut for window-management -->
        <!--<haxedef name="use_glut" />-->
        
        <libdir name="obj/lib"/>
        <outdir name="platforms/${LIB_SUFFIX}"/>
        <ext value=".ndll" if="linux"/>
        <ext value=".ndll" if="windows"/>

        <files id="foo3d"/>
        <files id="frame" if="use_glut"/>
        
        <!---------------------->
        <!-- System libraries -->
        <!---------------------->

        <lib name="-lGL" if="linux"/>
        <lib name="-lglut" if="linux"/>
        <lib name="-lGLEW" if="linux"/>

        <lib name="kernel32.lib" if="windows"/>
        <lib name="gdi32.lib" if="windows"/>
        <lib name="advapi32.lib" if="windows"/>
        <lib name="shell32.lib" if="windows"/>
        <lib name="user32.lib" if="windows"/>
        
        <lib name="opengl32.lib" if="windows"/>        
        <lib name="glew32s.lib" if="windows"/>
    </target>

    <target id="default">
        <target id="foo3d-hx"/>
    </target>
</xml>
